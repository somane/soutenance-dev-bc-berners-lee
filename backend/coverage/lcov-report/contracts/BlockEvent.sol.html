<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/BlockEvent.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> BlockEvent.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">58.33% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>56/96</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">38.75% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>31/80</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">53.85% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>7/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">62.88% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>83/132</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">82×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">82×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity 0.8.28;
&nbsp;
import "@openzeppelin/contracts/token/ERC1155/ERC1155.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/Counters.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "./BlockToken.sol";
&nbsp;
// Contract principal de BlockEvent pour la gestion de billetterie NFT
contract BlockEvent is ERC1155, Ownable, ReentrancyGuard {
    using Counters for Counters.Counter;
    
    // Référence au token de gouvernance
    BlockToken public governanceToken;
    
    // Constantes pour le système de tokens
    uint256 public constant TOKENS_PER_10_EUROS = 1 * 10**18; // 1 token pour 10€
    uint256 public constant VOTE_DISCOUNT_PERCENTAGE = 5;      // 5% de réduction si vote
    uint256 public constant DAO_TREASURY_PERCENTAGE = 20;      // 20% pour la DAO
    uint256 public constant ORGANIZER_TOKEN_PERCENTAGE = 10;   // 10% pour les organisateurs
    
    // Compteurs pour les IDs uniques
    Counters.Counter private _eventIdCounter;
    Counters.Counter private _ticketTypeIdCounter;
    Counters.Counter private _certificateIdCounter;
    
    // Structure pour définir un événement
    struct Event {
        string name;
        address organizer;
        uint256 date;
        uint256 maxResalePercentage;
        bool isActive;
        bool isCancelled;               // Nouveau: événement annulé ?
        uint256[] ticketTypeIds;
        uint256 totalRevenue;           // Nouveau: revenus totaux
        uint256 withdrawnAmount;        // Nouveau: montant déjà retiré
        mapping(address =&gt; bool) hasVoted; // Nouveau: qui a voté
        uint256 voteCount;              // Nouveau: nombre de votes
    }
    
    // Structure pour définir un type de billet
    struct TicketType {
        uint256 eventId;
        string name;
        uint256 price;
        uint256 maxSupply;
        uint256 currentSupply;
        bool hasOptions;
        string optionDescription;
        uint256 resalePrice;            // Nouveau: prix de revente fixe
        uint256 royaltyPercentage;      // Nouveau: % de royalties
    }
    
    // Structure pour les certificats de participation
    struct Certificate {
        uint256 eventId;
        uint256 certificateId;
        uint256 mintDate;
        bool isSpecial;                 // Certificat spécial (VIP, etc.)
    }
    
    // Mappings pour stocker les données
    mapping(uint256 =&gt; Event) public events;
    mapping(uint256 =&gt; TicketType) public ticketTypes;
    mapping(uint256 =&gt; uint256) public ticketOriginalPrice;
    mapping(uint256 =&gt; mapping(address =&gt; bool)) public hasUsedTicket;
    mapping(uint256 =&gt; Certificate) public certificates;     // Nouveau: certificats
    mapping(address =&gt; uint256[]) public userCertificates;  // Nouveau: certificats par user
    mapping(address =&gt; uint256) public userSpentAmount;     // Nouveau: montant dépensé par user
    mapping(address =&gt; bool) public hasReceivedVoteDiscount; // Nouveau: réduction vote utilisée
    
    // Treasury pour la DAO
    address public daoTreasury;
    
    // Events (logs)
    event EventCreated(uint256 eventId, string name, address organizer);
    event EventCancelled(uint256 eventId);
    event TicketTypeCreated(uint256 ticketTypeId, uint256 eventId, string name);
    event TicketPurchased(address buyer, uint256 ticketTypeId, uint256 amount);
    event TicketUsed(address user, uint256 ticketTypeId);
    event CertificateMinted(address user, uint256 certificateId, uint256 eventId);
    event TokensEarned(address user, uint256 amount);
    event UserVoted(address user, uint256 eventId);
    event FundsWithdrawn(address organizer, uint256 amount);
    
    constructor(address _daoTreasury) ERC1155("https://api.blockevent.com/metadata/{id}.json") {
        daoTreasury = _daoTreasury;
        // Déployer le token de gouvernance
        governanceToken = new BlockToken();
    }
    
    // Fonction pour créer un nouvel événement
    function createEvent(
        string memory _name,
        uint256 _date,
        uint256 _maxResalePercentage
    ) public {
        require(_date &gt; block.timestamp, "La date doit etre dans le futur");
        require(_maxResalePercentage &gt;= 100 &amp;&amp; _maxResalePercentage &lt;= 200, 
                "Le prix de revente doit etre entre 100% et 200%");
        
        _eventIdCounter.increment();
        uint256 newEventId = _eventIdCounter.current();
        
        Event storage newEvent = events[newEventId];
        newEvent.name = _name;
        newEvent.organizer = msg.sender;
        newEvent.date = _date;
        newEvent.maxResalePercentage = _maxResalePercentage;
        newEvent.isActive = true;
        newEvent.isCancelled = false;
        
        // Marquer l'adresse comme créateur d'événement
        governanceToken.isEventCreator(msg.sender);
        
        emit EventCreated(newEventId, _name, msg.sender);
    }
    
    // Nouvelle fonction: Annuler un événement et rembourser
<span class="fstat-no" title="function not covered" >    function cancelEvent(uint256 _eventId) public nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        Event storage eventInfo = events[_eventId];</span>
        
        // Vérifications
<span class="cstat-no" title="statement not covered" >        require(eventInfo.organizer == msg.sender, "Seul l'organisateur peut annuler")</span>;
<span class="cstat-no" title="statement not covered" >        require(!eventInfo.isCancelled, "Evenement deja annule")</span>;
<span class="cstat-no" title="statement not covered" >        require(block.timestamp &lt; eventInfo.date, "Evenement deja passe")</span>;
        
        // Marquer comme annulé
        eventInfo.isCancelled = true;
        eventInfo.isActive = false;
        
        // TODO: Dans une vraie implémentation, il faudrait:
        // 1. Parcourir tous les détenteurs de billets
        // 2. Les rembourser automatiquement
        // 3. Brûler leurs NFTs
        // Pour simplifier, on émet juste l'event ici
        
<span class="cstat-no" title="statement not covered" >        emit EventCancelled(_eventId);</span>
    }
    
    // Fonction pour ajouter un type de billet avec royalties
    function createTicketType(
        uint256 _eventId,
        string memory _name,
        uint256 _price,
        uint256 _maxSupply,
        bool _hasOptions,
        string memory _optionDescription,
        uint256 _royaltyPercentage  // Nouveau paramètre
    ) public {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(events[_eventId].organizer != address(0), "L'evenement n'existe pas");
        require(events[_eventId].organizer == msg.sender, "Seul l'organisateur peut creer des billets");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(events[_eventId].isActive, "L'evenement n'est pas actif");
        require(_royaltyPercentage &lt;= 10, "Royalties max 10%"); // Limite raisonnable
        
        _ticketTypeIdCounter.increment();
        uint256 newTicketTypeId = _ticketTypeIdCounter.current();
        
        TicketType storage newTicketType = ticketTypes[newTicketTypeId];
        newTicketType.eventId = _eventId;
        newTicketType.name = _name;
        newTicketType.price = _price;
        newTicketType.maxSupply = _maxSupply;
        newTicketType.currentSupply = 0;
        newTicketType.hasOptions = _hasOptions;
        newTicketType.optionDescription = _optionDescription;
        newTicketType.royaltyPercentage = _royaltyPercentage;
        newTicketType.resalePrice = _price; // Prix initial par défaut
        
        events[_eventId].ticketTypeIds.push(newTicketTypeId);
        ticketOriginalPrice[newTicketTypeId] = _price;
        
        emit TicketTypeCreated(newTicketTypeId, _eventId, _name);
    }
    
    // Nouvelle fonction: Définir le prix de revente
<span class="fstat-no" title="function not covered" >    function setResalePrice(uint256 _ticketTypeId, uint256 _newPrice) public {</span>
<span class="cstat-no" title="statement not covered" >        TicketType storage ticketType = ticketTypes[_ticketTypeId];</span>
<span class="cstat-no" title="statement not covered" >        Event storage eventInfo = events[ticketType.eventId];</span>
        
<span class="cstat-no" title="statement not covered" >        require(eventInfo.organizer == msg.sender, "Seul l'organisateur peut modifier")</span>;
<span class="cstat-no" title="statement not covered" >        require(_newPrice &lt;= (ticketType.price * eventInfo.maxResalePercentage) / 100,</span>
                "Prix depasse la limite autorisee");
        
        ticketType.resalePrice = _newPrice;
    }
    
    // Fonction pour acheter des billets (mise à jour avec tokens)
    function buyTickets(uint256 _ticketTypeId, uint256 _amount) public payable <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant {
        TicketType storage ticketType = ticketTypes[_ticketTypeId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(ticketType.price &gt; 0, "Ce type de billet n'existe pas");
        require(ticketType.currentSupply + _amount &lt;= ticketType.maxSupply, 
                "Pas assez de billets disponibles");
        
        Event storage eventInfo = events[ticketType.eventId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!eventInfo.isCancelled, "Evenement annule");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &lt; eventInfo.date, "L'evenement est termine");
        
        // Calculer le prix avec réduction si l'utilisateur a voté
        uint256 unitPrice = ticketType.price;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (hasReceivedVoteDiscount[msg.sender] &amp;&amp; eventInfo.hasVoted[msg.sender]) {
            unitPrice = (unitPrice * (100 - VOTE_DISCOUNT_PERCENTAGE)) / 100;
            hasReceivedVoteDiscount[msg.sender] = false; // Utiliser la réduction une fois
        }
        
        uint256 totalPrice = unitPrice * _amount;
        require(msg.value &gt;= totalPrice, "Montant insuffisant");
        
        // Minter les NFTs
        _mint(msg.sender, _ticketTypeId, _amount, "");
        ticketType.currentSupply += _amount;
        
        // Mettre à jour les revenus
        eventInfo.totalRevenue += totalPrice;
        
        // Calculer et distribuer les tokens BLK
        uint256 tokensToMint = (totalPrice * TOKENS_PER_10_EUROS) / (10 * 10**18); // Assumant 1 ETH = 1000€
        
        // 80% pour l'acheteur
        uint256 buyerTokens = (tokensToMint * 80) / 100;
        governanceToken.mint(msg.sender, buyerTokens);
        
        // 10% pour l'organisateur
        uint256 organizerTokens = (tokensToMint * ORGANIZER_TOKEN_PERCENTAGE) / 100;
        governanceToken.mint(eventInfo.organizer, organizerTokens);
        
        // 10% pour la DAO (les 10% restants du 20% vont directement au treasury)
        uint256 daoTokens = (tokensToMint * 10) / 100;
        governanceToken.mint(daoTreasury, daoTokens);
        
        // Enregistrer le montant dépensé
        userSpentAmount[msg.sender] += totalPrice;
        
        emit TicketPurchased(msg.sender, _ticketTypeId, _amount);
        emit TokensEarned(msg.sender, buyerTokens);
        
        // Rembourser l'excédent
        if (msg.value &gt; totalPrice) {
            payable(msg.sender).transfer(msg.value - totalPrice);
        }
    }
    
    // Nouvelle fonction: Retirer les fonds (organisateur)
<span class="fstat-no" title="function not covered" >    function withdrawFunds(uint256 _eventId) public nonReentrant {</span>
<span class="cstat-no" title="statement not covered" >        Event storage eventInfo = events[_eventId];</span>
        
<span class="cstat-no" title="statement not covered" >        require(eventInfo.organizer == msg.sender, "Seul l'organisateur peut retirer")</span>;
<span class="cstat-no" title="statement not covered" >        require(!eventInfo.isCancelled, "Evenement annule")</span>;
<span class="cstat-no" title="statement not covered" >        require(block.timestamp &gt; eventInfo.date, "Attendez la fin de l'evenement")</span>;
        
<span class="cstat-no" title="statement not covered" >        uint256 availableAmount = eventInfo.totalRevenue - eventInfo.withdrawnAmount;</span>
<span class="cstat-no" title="statement not covered" >        require(availableAmount &gt; 0, "Aucun fond disponible")</span>;
        
        // Prélever les frais de la plateforme (ex: 2.5%)
<span class="cstat-no" title="statement not covered" >        uint256 platformFee = (availableAmount * 25) / 1000;</span> // 2.5%
<span class="cstat-no" title="statement not covered" >        uint256 organizerAmount = availableAmount - platformFee;</span>
        
        // Mettre à jour le montant retiré
        eventInfo.withdrawnAmount += availableAmount;
        
        // Transférer les fonds
<span class="cstat-no" title="statement not covered" >        payable(daoTreasury).transfer(platformFee)</span>;
<span class="cstat-no" title="statement not covered" >        payable(msg.sender).transfer(organizerAmount)</span>;
        
<span class="cstat-no" title="statement not covered" >        emit FundsWithdrawn(msg.sender, organizerAmount);</span>
    }
    
    // Fonction pour valider un billet
    function validateTicket(uint256 _ticketTypeId, address _ticketHolder) public {
        TicketType storage ticketType = ticketTypes[_ticketTypeId];
        Event storage eventInfo = events[ticketType.eventId];
        
        <span class="missing-if-branch" title="else path not taken" >E</span>require(eventInfo.organizer == msg.sender, "Seul l'organisateur peut valider");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(balanceOf(_ticketHolder, _ticketTypeId) &gt; 0, "L'utilisateur n'a pas ce billet");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(!hasUsedTicket[_ticketTypeId][_ticketHolder], "Billet deja utilise");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(block.timestamp &gt;= eventInfo.date - 2 hours &amp;&amp; 
                block.timestamp &lt;= eventInfo.date + 6 hours, 
                "Validation uniquement le jour de l'evenement");
        
        hasUsedTicket[_ticketTypeId][_ticketHolder] = true;
        emit TicketUsed(_ticketHolder, _ticketTypeId);
    }
    
    // Nouvelle fonction: Créer un certificat de participation
<span class="fstat-no" title="function not covered" >    function mintCertificate(uint256 _eventId, address _participant, bool _isSpecial) public {</span>
<span class="cstat-no" title="statement not covered" >        Event storage eventInfo = events[_eventId];</span>
        
        // Vérifications
<span class="cstat-no" title="statement not covered" >        require(eventInfo.organizer == msg.sender, "Seul l'organisateur peut emettre")</span>;
<span class="cstat-no" title="statement not covered" >        require(block.timestamp &gt; eventInfo.date, "Attendez la fin de l'evenement")</span>;
        
        // Vérifier que le participant avait bien un billet utilisé
<span class="cstat-no" title="statement not covered" >        bool hadTicket = false;</span>
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt; eventInfo.ticketTypeIds.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >            if (hasUsedTicket[eventInfo.ticketTypeIds[i]][_participant]) {</span>
                hadTicket = true;
                break;
            }
        }
<span class="cstat-no" title="statement not covered" >        require(hadTicket, "Le participant n'a pas assiste")</span>;
        
        // Créer le certificat
<span class="cstat-no" title="statement not covered" >        _certificateIdCounter.increment()</span>;
<span class="cstat-no" title="statement not covered" >        uint256 newCertId = _certificateIdCounter.current();</span>
        
        // ID unique pour le NFT certificat (différent des billets)
<span class="cstat-no" title="statement not covered" >        uint256 certificateTokenId = 1000000 + newCertId;</span> // Offset pour éviter collision
        
        certificates[newCertId] = Certificate({
            eventId: _eventId,
            certificateId: newCertId,
            mintDate: block.timestamp,
            isSpecial: _isSpecial
        });
        
        // Minter le NFT certificat
<span class="cstat-no" title="statement not covered" >        _mint(_participant, certificateTokenId, 1, "")</span>;
<span class="cstat-no" title="statement not covered" >        userCertificates[_participant].push(newCertId)</span>;
        
        // Bonus tokens pour certificat spécial
<span class="cstat-no" title="statement not covered" >        if (_isSpecial) {</span>
<span class="cstat-no" title="statement not covered" >            governanceToken.mint(_participant, 10 * 10**18)</span>; // 10 tokens bonus
        }
        
<span class="cstat-no" title="statement not covered" >        emit CertificateMinted(_participant, newCertId, _eventId);</span>
    }
    
    // Nouvelle fonction: Voter pour un événement
    function voteForEvent(uint256 _eventId) public {
        Event storage eventInfo = events[_eventId];
        
        // Vérifier que l'utilisateur a des tokens
        require(governanceToken.balanceOf(msg.sender) &gt; 0, "Vous devez avoir des tokens BLK");
        
        // Vérifier que l'utilisateur a participé à l'événement
        bool participated = false;
        for (uint256 i = 0; i &lt; eventInfo.ticketTypeIds.length; i++) {
            <span class="missing-if-branch" title="else path not taken" >E</span>if (balanceOf(msg.sender, eventInfo.ticketTypeIds[i]) &gt; 0) {
                participated = true;
                break;
            }
        }
        <span class="missing-if-branch" title="else path not taken" >E</span>require(participated, "Vous devez avoir participe a l'evenement");
        
        // Vérifier qu'il n'a pas déjà voté
        require(!eventInfo.hasVoted[msg.sender], "Vous avez deja vote");
        
        // Enregistrer le vote
        eventInfo.hasVoted[msg.sender] = true;
        eventInfo.voteCount++;
        hasReceivedVoteDiscount[msg.sender] = true; // Activer la réduction pour prochain achat
        
        // Récompenser l'organisateur avec des tokens
        governanceToken.mint(eventInfo.organizer, 5 * 10**18); // 5 tokens par vote
        
        emit UserVoted(msg.sender, _eventId);
    }
    
    // Override pour gérer les royalties sur les transferts
<span class="fstat-no" title="function not covered" >    function safeTransferFrom(</span>
        address from,
        address to,
        uint256 id,
        uint256 amount,
        bytes memory data
    ) public virtual override {
        // Si c'est un transfert de billet (pas depuis l'adresse 0)
<span class="cstat-no" title="statement not covered" >        if (from != address(0) &amp;&amp; id &lt; 1000000) { // Les certificats ont un ID &gt; 1000000</span>
<span class="cstat-no" title="statement not covered" >            TicketType storage ticketType = ticketTypes[id];</span>
            
            // Si des royalties sont définies et que ce n'est pas l'organisateur
<span class="cstat-no" title="statement not covered" >            if (ticketType.royaltyPercentage &gt; 0 &amp;&amp; to != events[ticketType.eventId].organizer) {</span>
                // TODO: Implémenter le système de paiement des royalties
                // Dans une vraie implémentation, il faudrait un système de paiement intégré
            }
        }
        
<span class="cstat-no" title="statement not covered" >        super.safeTransferFrom(from, to, id, amount, data)</span>;
    }
    
    // Fonction helper pour obtenir les infos complètes d'un événement
    function getEventInfo(uint256 _eventId) public view returns (
        string memory name,
        address organizer,
        uint256 date,
        bool isActive,
        bool isCancelled,
        uint256 totalRevenue,
        uint256 voteCount,
        uint256[] memory ticketTypeIds
    ) {
        Event storage eventInfo = events[_eventId];
        return (
            eventInfo.name,
            eventInfo.organizer,
            eventInfo.date,
            eventInfo.isActive,
            eventInfo.isCancelled,
            eventInfo.totalRevenue,
            eventInfo.voteCount,
            eventInfo.ticketTypeIds
        );
    }
    
    // Fonction pour obtenir le solde de tokens d'un utilisateur
<span class="fstat-no" title="function not covered" >    function getTokenBalance(address user) public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return governanceToken.balanceOf(user);</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun Jul 20 2025 19:47:51 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
